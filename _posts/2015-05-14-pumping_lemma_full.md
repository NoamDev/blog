---
id: 3249
title: "למת הניפוח לשפות רגולריות - גרסה מלאה"
date: 2015-05-14 11:01:46
layout: post
categories: 
  - תורת הסיבוכיות
tags: 
  - למת הניפוח
  - משפט רמזי
  - שפות פורמליות
---
הצגתי כאן בעבר את ל<a href="http://www.gadial.net/2015/02/03/pumping_lemma_regular_languages/">מת הניפוח לשפות רגולריות</a>, ואני רוצה לחזור עכשיו לנושא ולהציג גרסה נוספת, מוכללת, של הלמה - גרסה שהיא חזקה מספיק כדי לתת לנו תוצאת "אם ורק אם". כזכור, למת הניפוח נתנה לנו תנאי <strong>הכרחי</strong> לכך ששפה תהיה רגולרית: דהיינו, אם השפה לא קיימה את הלמה, זו הייתה הוכחה שהשפה אינה רגולרית. הבעיה הייתה שהיו שפות שקיימו את הלמה למרות שהן לא רגולריות. הגרסה שאני אציג עכשיו לא סובלת מהבעיה הזו - שפה היא רגולרית אם ורק אם היא מקיימת את הלמה; אבל כמובן, הניסוח של הלמה מורכב הרבה יותר מאשר קודם, ולכן יהיה יותר קשה להראות ששפה לא מקיימת אותה. העניין שלי בתוצאה הזו, אם כן, הוא יחסית תיאורטי; כדי להראות ששפה היא לא רגולרית עדיין אנסה קודם כל להשתמש בלמה ה"רגילה". אגב, לי כל זה מזכיר את <strong>משפט רייס</strong> בחישוביות; גם לו יש <a href="http://www.gadial.net/2007/10/09/rice_theorem/">גרסה פשוטה</a> שהיא חד כיוונית, ו<a href="http://www.gadial.net/2011/05/18/rice_theorem_full_version/">גרסה יותר מעניינת</a> שהיא אם ורק אם.

הפוסט הזה, מן הסתם, מניח שאתם כבר מכירים את למת הניפוח, ולכן אצלול ישר לעומק הסיפור. אם אתם מאבדים אותי, נסו לקרוא שוב את הפוסט הקודם.

הניסוח הכללי של הלמה לא קל לעיכול, אז בואו ניזכר לרגע מה קרה בניסוח הפשוט ואיך הגענו אליו. $latex L$ מקיימת את הלמה אם קיים מספר טבעי $latex n$ כך שכל מילה $latex z\in L$ המקיימת $latex \left\|z\right\|\ge n$ ניתנת לפירוק $latex z=uvw$ כך ש-$latex \left\|uv\right\|\le n$ ו-$latex \left\|v\right\|\ge1$ ו-$latex uv^{i}w\in L$ לכל $latex i\ge0$. למה זה עובד? כי לוקחים את $latex n$ להיות מספר המצבים באוטומט עבור $latex L$ ומסתכלים על ריצה שמקבלת את $latex z$. כבר אחרי $latex n$ הצעדים הראשונים של הריצה יהיה מצב שחוזר על עצמו; מסמנים ב-$latex u$ את מה שקראנו עד להגעה הראשונה למצב, ב-$latex v$ את מה שקראנו כדי לעבור מהמצב אל עצמו, וב-$latex w$ את יתר המילה. התנאי של ה-$latex \left\|uv\right\|\le n$ נובע מכך שההגעה השניה שלנו למצב הזה היא במסגרת $latex n$ הצעדים הראשונים.

אם כן, הרכיב המרכזי בהוכחה הוא העניין הזה של "ביצעת יותר מ-$latex n$ צעדים? קבל מעגל!". הנקודה החשובה היא שזה בכלל <strong>לא חשוב</strong> מתי הצעדים הללו מתבצעים - בהתחלה, באמצע, בסוף, עם פער ביניהם, בלי פער ביניהם - אם ניקח את ריצת האוטומט על מילה, ו"נעצור כדי להציץ" את הריצה $latex n+1$ פעמים, אז יהיו שתי הצצות כאלו לפחות שיראו שהאוטומט באותו מצב בדיוק (ב-$latex n$ צעדים יש $latex n+1$ "הצצות": המצב בהתחלה והמצב אחרי כל צעד). אם זיהינו שתי הצצות שבהן האוטומט היה באותו מצב בדיוק, אז אפשר לקחת את <strong>כל הריצה בין שתיהן</strong> (לא רק את ההצצות בין שתיהן; את כל הריצה) ולשכפל אותה $latex i$ פעמים.

אז הנה ניסוח כללי יותר מאשר קודם: אם $latex L$ רגולרית אז קיים $latex n$ כך שלכל $latex z\in L$ ולכל פירוק $latex z=uv_{1}v_{2}\dots v_{n}w$ שלה כך ש-$latex \left\|v_{i}\right\|\ge1$ לכל $latex 1\le i\le n$, קיימים זוג אינדקסים $latex 0\le k_{1}&lt;k_{2}\le n$ כך ש-$latex uv_{1}\dots\left(v_{k_{1}+1}\dots v_{k_{2}}\right)^{i}\dots v_{n}w\in L$ לכל $latex i\ge0$. זו בבירור הכללה של הלמה הרגילה: אם אני בוחר $latex u=\varepsilon$ ו-$latex v_{i}=z_{i}$ (כלומר, ה-$latex v$-ים הם בדיוק $latex n$ האותיות הראשונות ב-$latex z$) אני אקבל את הלמה הרגילה (כאשר מי שאני קורא לו $latex v$ בלמה הרגילה יהיו האותיות $latex z_{k_{1}}\dots z_{k_{2}}$).

הניסוח הזה הוא <strong>עדיין</strong> לא אם ורק אם. כדי לקבל משהו שהוא אם ורק אם, צריך להוסיף עוד דבר אחד: במקום לדבר רק על המילים ב-$latex z$, צריך לדבר על <strong>כל</strong> המילים, כולל כאלו שאינן בשפה. הנה הניסוח הכללי ביותר, שהוא אם-ורק-אם:

אם $latex L$ רגולרית אז קיים $latex n$ כך שלכל $latex z$ ולכל פירוק $latex z=uv_{1}v_{2}\dots v_{n}w$ שלה כך ש-$latex \left\|v_{i}\right\|\ge1$ לכל $latex 1\le i\le n$, קיימים זוג אינדקסים $latex 0\le k_{1}&lt;k_{2}\le n$ כך שלכל $latex i\ge0$ מתקיים ש- $latex z\in L\iff uv_{1}\dots\left(v_{k_{1}+1}\dots v_{k_{2}}\right)^{i}\dots v_{n}w\in L$.

במילים אחרות, עבור הפירוק הנתון, או ש<strong>כל</strong> הניפוחים שלו יהיו ב-$latex L$, או שאף אחד מהם לא יהיה ב-$latex L$. זה לא כל כך מפתיע שאם $latex L$ רגולרית אז התכונה הזו מתקיימת: זכרו מה ניפוח עושה בפועל - הוא לוקח ריצה קיימת של אוטומט, ומשנה את מספר הפעמים שבהן אנחנו רצים על מקטע <strong>מיותר</strong> של הריצה - כזה שבתחילתו ובסופו אנחנו בדיוק באותו מצב, ולכן בין אם נשמוט אותו לגמרי ובין אם נחזור עליו אינספור פעמים - הריצה עצמה תישאר אותו דבר. המצב הסופי שנגיע אליו יהיה אותו דבר - או שהוא יהיה תמיד מקבל, או שהוא יהיה תמיד לא מקבל (אני מניח, כמובן, שהאוטומט שלנו דטרמיניסטי).

מה שמעניין הוא שהתנאי הזה הוא גם <strong>מספיק</strong>, כלומר שאם הוא מתקיים, אז $latex L$ רגולרית. ולמעשה, אפילו אפשר להחליש אותו קצת ולהתייחס רק למקרה שבו $latex i=0$. כלומר, הנה המשפט שאני רוצה להוכיח:

בהינתן שפה $latex L$, אם קיים $latex n$ כך שלכל $latex z$ ולכל פירוק $latex z=uv_{1}v_{2}\dots v_{n}w$ שלה כך ש-$latex \left\|v_{i}\right\|\ge1$ לכל $latex 1\le i\le n$, קיימים זוג אינדקסים $latex 0\le k_{1}&lt;k_{2}\le n$ כך שמתקיים $latex z\in L\iff uv_{1}\dots v_{k_{1}}v_{k2+1}\dots v_{n}w\in L$, אז $latex L$ רגולרית.

כאן $latex uv_{1}\dots v_{k_{1}}v_{k2+1}\dots v_{n}w$ זו פשוט דרך קומפקטית לכתוב $latex uv_{1}\dots\left(v_{k_{1}+1}\dots v_{k_{2}}\right)^{0}\dots v_{n}w$.

מעכשיו אקרא לדבר הזה "<strong>התכונה</strong>". שימו לב שהתכונה הזו תלויה בפרמטר שמאפיין אותה - $latex n$. מכאן ואילך גם הוא יהיה קבוע.

למה שהתכונה הזו תהיה שקולה לכך ששפה היא רגולרית? איך בכלל אפשר להראות שהשפה היא רגולרית? נבנה לה אוטומט? ובכן, לא. בואו ניזכר בקריטריון נטול אוטומטים לכך ששפה היא רגולרית: אם משפט מייהיל-נרוד חל עליה. כלומר, אם יש ליחס השקילות $latex R_{L}$ רק מספר סופי של מחלקות שקילות, או באופן שקול - אם קיים רק מספר סופי של שפות מהצורה $latex u^{-1}L$ (כזכור, $latex u^{-1}L\triangleq\left\{ v\in\Sigma^{*}\ \|\ uv\in L\right\} $ ).

מה שהתכונה של למת הניפוח נותנת לנו הוא עוד משהו שהוא מעין-סופי שכזה. בניסוח מילולי התכונה אומרת "לכל מילה מאורך גדול מ-$latex n$ אפשר למצוא מילה קצרה יותר כך ששתיהן ביחד ב-$latex L$ או לא ב-$latex L$". אם חוזרים על התהליך הזה מספיק פעמים מגיעים אל מילה מאורך לכל היותר $latex n$ שגורלה זהה לגורל המילה המקורית שהתחלנו ממנה. זה אומר שהשפה $latex L$ שלנו מאופיינת במובן מסויים על פי המילים עד גודל $latex n$ ששייכות אליה. אם נצליח להוכיח ששתי שפות <strong>שונות </strong>$latex L_{1},L_{2}$ ששתיהן מקיימות את התכונה עבור אותו קבוע $latex n$ לא יכולות להיות מאופיינות על ידי אותה קבוצה של מילים-עד-גודל $latex n$, נלמד מזה משהו מעניין מאוד: שיש רק מספר <strong>סופי</strong> של שפות שמקיימות את התכונה עבור $latex n$ (אגב, אני מזהיר מראש שאני משקר כדי לתת לכם אינטואיציה: אלו לא "מילים-עד-גודל $latex n$" אלא "מילים-עד-גודל $latex N$ שהוא מספר שונה לגמרי ועוד נבין בהמשך איך מגיעים אליו אבל סבלנות חברים").

זה מתווה לנו את האסטרטגיה להוכחה: השלב הראשון, הקל, יהיה להוכיח שאם $latex L$ מקיימת את התכונה עבור הקבוע $latex n$, אז גם $latex u^{-1}L$ מקיימת את התכונה עבור אותו קבוע $latex n$. השלב השני, הקשה יותר, יהיה להוכיח את מה שדיברתי עליו בפסקה הקודמת. אחרי שנסיים את שני השלבים הללו, משפט מייהיל-נרוד מסיים את העבודה: יש רק מספר סופי של שפות שמקיימות את התכונה עבור $latex n$, וכל $latex u^{-1}L$ מקיימת את התכונה עבור $latex n$, אז יש רק מספר סופי של שפות מהצורה $latex u^{-1}L$.

נתחיל עם השלב הקל. אנחנו מניחים ש-$latex L$ מקיימת את התכונה עבור $latex n$. בואו ניקח $latex u\in\Sigma^{*}$ כלשהו ונוכיח שגם $latex u^{-1}L$ מקיימת את התכונה. כלומר, ניקח $latex z\in u^{-1}L$ ופירוק $latex z=xv_{1}v_{2}\dots v_{n}y$ של $latex z$. מה שאנחנו צריכים לעשות הוא למצוא זוג אינדקסים כך שאפשר להשמיט את ה-$latex v$-ים שביניהם ולקבל מילה ששקולה ל-$latex z$ מבחינת שייכות ל-$latex u^{-1}L$.

כעת, מכיוון ש-$latex z\in u^{-1}L$, נובע מכך ש-$latex uz\in L$. אז אפשר להשתמש בתכונה על $latex uz$: ניקח את הפירוק $latex z=uxv_{1}\dots v_{n}y$ ונמצא שני אינדקסים <strong>עבורו</strong>. שימו לב כמה העסק פשוט - את ה-$latex u$ שבתחילת המילה אנחנו דוחפים לאיזור של ה"לא מעניין, אין צורך למחוק מכאן דברים", והכל ממשיך כרגיל. אנחנו מקבלים שקיימים $latex k_{1},k_{2}$ כך ש-$latex uz\in L\iff uxv_{1}\dots v_{k_{1}}v_{k2+1}\dots v_{n}y\in L$; המסקנה המיידית היא ש-$latex z\in u^{-1}L\iff xv_{1}\dots v_{k_{1}}v_{k2+1}\dots v_{n}y\in u^{-1}L$, וזה מה שרצינו להראות. אז זה היה קל.

בואו נעבור לחלק הקשה. בשביל החלק הקשה, אני הולך לשלוף שפן מהכובע: <strong>משפט רמזי</strong>. <a href="http://www.gadial.net/2011/08/03/ramsey_theorem/">יש לי פוסט בנושא</a>, אבל הנה הרעיון הבסיסי, בכמה ניסוחים, עבור מי שלא מכיר חלק מהטרמינולוגיות:

לכל זוג מספרים $latex r,s$ טבעיים קיים מספר $latex R\left(r,s\right)$ כך שבכל קבוצה עם לפחות $latex R\left(r,s\right)$ אנשים שכל זוג מביניהם הם או אויבים או חברים, קיימת קבוצה מגודל $latex r$ שכולם בה חברים, או קבוצה מגודל $latex s$ שכולם בה אויבים.

לכל זוג מספרים $latex r,s$ טבעיים קיים מספר $latex R\left(r,s\right)$ כך שבכל גרף מלא עם לפחות $latex R\left(r,s\right)$ שקשתותיו צבועות באדום או כחול, קיימת קבוצה של $latex r$ צמתים שכל הקשתות ביניהם אדומות, או $latex s$ צמתים שכל הקשתות ביניהם כחולות.

לכל זוג מספרים $latex r,s$ טבעיים קיים מספר $latex R\left(r,s\right)$ כך שבכל גרף עם לפחות $latex R\left(r,s\right)$ קודקודים קיים קליק מגודל $latex r$ או קבוצה בלתי תלויה מגודל $latex s$. זה הניסוח שבו אני אשתמש בהמשך, ואני מקווה שהוא ברור עכשיו (קליק היא קבוצה של צמתים כך שבין כל זוג מביניהם קיימת קשת; קבוצה בלתי תלויה היא קבוצת צמתים כך שלכל זוג מביניהם אין קשת).

יופי, איך זה קשור בכלל?

בואו ניקח את $latex N=R\left(n+1,n+1\right)$. אני רוצה לטעון שאם יש לי שתי שפות $latex L_{1},L_{2}$, כך ש:
<ol>
	<li>$latex L_{1},L_{2}$ מקיימות את התכונה עבור $latex n$.</li>
	<li>$latex L_{1},L_{2}$ מסכימות על כל המילים עד גודל $latex N-1$, דהיינו $latex \left\{ w\in L_{1}\ \|\ \left\|w\right\|\le N-1\right\} =\left\{ w\in L_{2}\ \|\ \left\|w\right\|\le N-1\right\} $.</li>
</ol>
אז מתקיים $latex L_{1}=L_{2}$. זה מסיים את ההוכחה, כי יש רק מספר סופי של קבוצות מילים עד גודל $latex N-1$ (יש בדיוק $latex 2^{N-1}$ כאלו).

כלומר, אנחנו רוצים להוכיח ש-$latex w\in L_{1}\iff w\in L_{2}$ לכל $latex w\in\Sigma^{*}$. ההוכחה תהיה באינדוקציה על האורך של $latex w$. הבסיס נתון לנו, עד $latex \left\|w\right\|=N-1$. לכן אפשר להניח ש-$latex \left\|w\right\|\ge N$. בואו נסמן את $latex N-1$ האותיות הראשונות של $latex w$ במפורש: $latex w=a_{1}a_{2}\dots a_{N-1}w^{\prime}$. עכשיו אפשר להגדיר את הגרף שעליו נפעיל את משפט רמזי שלנו. הצמתים יהיו פשוט המספרים $latex V=\left\{ 0,2,\dots,N-1\right\} $ (ולכן הגרף גדול מספיק כדי שנוכל להפעיל עליו את משפט רמזי). הקשתות יהיו בין זוגות אינדקסים שעבורם התכונה של $latex n$ מתקיימת ביחס ל-$latex L_{1}$, כלומר

$latex E=\left\{ \left(i,j\right)\ \|\ 0\le i&lt;j\le N-1,\ a_{1}a_{2}\dots a_{i}a_{j+1}\dots a_{N-1}w^{\prime}\in L_{1}\right\} $

קרוב לודאי שאתם מרגישים שיש פה חוסר סימטריה מוזר - השתמשתי ב-$latex L_{1}$, אבל מה עם $latex L_{2}$? ובכן, שימו לב שהייתי יכול באותה מידה בדיוק להשתמש ב-$latex L_{2}$ ולקבל את אותה $latex E$, <strong>בזכות הנחת האינדוקציה</strong> (כי אנחנו כבר משוכנעים ש-$latex L_{1},L_{2}$ זהות על כל מילה ארוכה פחות מ-$latex w$).

עכשיו אפשר להשתמש במשפט רמזי. נקבל שקיימת קבוצה $latex U$ של $latex n+1$ מספרים $latex F=\left\{ i_{0},i_{1},\dots,i_{n}\right\} $, כך שכל זוג מספרים מהקבוצה שייך ל-$latex E$, או שכל זוג מספרים מהקבוצה לא שייך ל-$latex E$.

כעת סוף סוף אפשר להשתמש בנתון הנוסף שלנו, לפיו $latex L_{1},L_{2}$ מקיימות את התכונה עבור $latex n$. אנחנו רוצים להשתמש בתכונה עבור $latex w$, כמובן, אבל בשביל זה אנחנו קודם כל צריכים להציג פירוק של $latex w$: הפירוק יתבסס על קבוצת האינדקסים שמשפט רמזי נתן לנו. נגדיר $latex w=xv_{1}v_{2}\dots v_{n}y$ כך ש-$latex v_{1}=a_{i_{0}}\dots a_{i_{1}}$ ו-$latex v_{2}=a_{i_{1}}\dots a_{i_{2}}$ וכן הלאה עד $latex v_{n}=a_{i_{n-1}}\dots a_{i_{n}}$.

עכשיו צריך להבדיל בין שני המקרים של משפט רמזי.

במקרה הראשון, שבו כל זוג איברים מ-$latex U$ מחוברים בקשת, אנחנו יודעים שלכל $latex i&lt;j$ כך ש-$latex i,j\in U$ נקבל ש-$latex xv_{1}v_{2}\dots v_{i}\dots v_{j+1}\dots v_{n}\in L_{1}$ וגם $latex xv_{1}v_{2}\dots v_{i}\dots v_{j+1}\dots v_{n}\in L_{2}$. זו בעצם דרך "לסדר" את התכונה - התכונה הרי אומרת רק ש<strong>קיימים</strong> זוג אינדקסים שעבורם אנחנו מקבלים מילה שגורלה זהה לזה של $latex w$. עכשיו אנחנו אומרים שהמשחק הזה מכור מראש - לכל זוג אינדקסים שנבחר, התוצאה תהיה תמיד זהה - שייכות לשפה. רואים איך זה מסיים?

עדיין, בואו נכתוב את זה באופן מפורש. מכיוון ש-$latex L_{1}$ מקיימת את התכונה, קיימים $latex k_{1},k_{2}$ כך ש-$latex w\in L_{1}\iff xv_{1}\dots v_{k_{1}}\dots v_{k_{2}+1}\dots v_{n}\in L_{1}$. מכיוון שאגף ימין מתקיים, אנחנו מקבלים ש-$latex w\in L_{1}$. באותו אופן בדיוק, מכיוון ש-$latex L_{2}$ מקיימת את התכונה, קיימים $latex t_{1},t_{2}$ (אולי <strong>שונים</strong> מ-$latex k_{1},k_{2}$ - כל הפואנטה היא שזה לא משנה, בשביל זה היינו צריכים את רמזי) כך ש-$latex w\in L_{2}\iff xv_{1}\dots v_{t_{1}}\dots v_{t_{2}+1}\dots v_{n}\in L_{2}$, וקיבלנו שגם $latex w\in L_{2}$. המקרה השני של משפט רמזי הוא אותו הדבר, רק שנקבל הפעם ש-$latex w\notin L_{1}$ וגם $latex w\notin L_{2}$. סך הכל קיבלנו את מה שרצינו: $latex w\in L_{1}\iff w\in L_{2}$. זה מסיים את ההוכחה.

לא מגניב? מגניב. שימושי? שאלה טובה. רוצים להציע בתגובות שפות שקשה להוכיח שהן רגולריות אלא אם משתמשים בלמה הזו?
