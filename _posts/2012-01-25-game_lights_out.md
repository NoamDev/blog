---
id: 1500
title: 'כיבוי אורות (או: תורת הגרפים והאלגברה הלינארית מחסלות עוד משחק תמים)'
date: 2012-01-25T11:26:50+00:00
author: gadial
layout: post
guid: http://www.gadial.net/?p=1500
permalink: /2012/01/25/game_lights_out/
categories:
  - אלגברה לינארית
  - משחקים וחידות מתמטיות
  - תורת הגרפים
tags:
  - Lights out
  - אלגברה לינארית
  - מטריצה מייצגת של גרף
  - פתרון מתמטי של משחק
  - תורת הגרפים
---
"[כיבוי אורות](http://en.wikipedia.org/wiki/Lights_Out_)game()", או Lights Out הוא משחק תמים שהולך כך: נתון לוח משבצות של $latex 5\times5$, כך שכל משבצת יכולה להיות מוארת או כבויה; נניח מכאן ואילך עד לסוף הפוסט (כמעט) שבתחילת המשחק כל המשבצות כבויות. כל לחיצה על משבצת משנה את מצב המשבצת ומצב כל השכנות שלה: משבצת שהייתה כבויה נדלקת, ומשבצת שהייתה דלוקה כבה. המטרה: להגיע למצב שבו כל הנורות דולקות.

אוהו, אומרים ותיקי הבלוג. עוד משחק בלתי פתיר ועוד אינוריאנטים מעיקים. ובכן, לא הפעם. המשחק פתיר, ולא סתם - אני רוצה להראות שבעצם כל המשחקים מסוגו פתירים. אציג שתי הוכחות - האחת קומבינטורית באופיה, והשניה (של נגה אלון) מבוססת על אלגברה לינארית. אגב, מי שרוצה להתנסות במשחק בעצמו יכול לעשות זאת כרגע ב[אתר של החברה](http://genuine-lights-out.com) שאחראית לו.

האופן הטבעי להכליל את הבעיה הוא לדבר על **גרף** (אניח שהקוראים מכירים את המושג הזה). המשבצות הן צמתים, וקשת בין שני צמתים מייצגת משבצות שכנות. בצורה הזו אפשר לייצג לוח $latex n\times n$ ריבועי כלשהו; וגם לוחות מלבניים; ועם משושים או משולשים; או תלת ממדיים, או כל דבר בעצם. אני לא אניח שום דבר על הגרף שאני תוקף.

הדבר הראשון שצריך לשים לב אליו הוא שאמנם טבעי לחשוב על המשחק בגישה "סדרתית" ("קודם אלחץ כאן ואז אלחץ שם") אבל זה מיותר לגמרי. אין שום חשיבות לסדר שבו לוחצים על משבצות, וגם אין שום צורך ללחוץ על משבצת יותר מפעם אחת (לחיצה כפולה פשוט מנטרלת את האפקט של הלחיצה הראשונה; אם לחצנו פעמיים, גם אם חלף פרק זמן גדול בין הלחיצות ועשינו דברים אחרים בלוח, זה שקול לחלוטין לכך שמעולם לא היינו לוחצים וחסל). כלומר, הדרך ה"נכונה" לנצח במשחק היא פשוט ללחוץ בו זמנית על קבוצה מסויימת של צמתים, וזהו. פורמלית, אם $latex V$ היא קבוצת צמתי הגרף, אנו מחפשים תת-קבוצה $latex S\subseteq V$ כך שלכל צומת $latex v\notin S$ יש מספר אי זוגי של שכנים מתוך $latex S$, ואילו לכל צומת $latex v\in S$ יש מספר זוגי של שכנים מתוך $latex S$ (זוגי, כי אנחנו נלחץ גם על $latex v$ עצמו, ואנחנו רוצים שכל הלחיצות שלנו על השכנים של $latex v$ יבטלו אלו את אלו בכל מה שנוגע ל-$latex v$).

כאן אני שולף מהשרוול שפן בדמות טענה לא טריוויאלית לגמרי בתורת הגרפים - לכל גרף אפשר לפרק את קבוצת הצמתים שלו לשתי קבוצות זרות $latex V\_{1},V\_{2}$ כך שבתת-הגרפים המושרים על $latex V\_{1},V\_{2}$ כל הצמתים הם מדרגה זוגית. תכף אוכיח את הטענה הזו אבל בואו נבין איך נעזרים בה כדי להראות שקיימת בגרף קבוצה $latex S$ כמו שאנחנו רוצים. הרעיון הוא לבצע בניית עזר - לקחת את הגרף של המשחק, ולהוסיף צומת חדשה $latex u$ שמחוברת לכל צומת בגרף שדרגתו זוגית. כעת אפשר לחלק את הגרף לשתי קבוצות $latex V\_{1},V\_{2}$ כאמור לעיל. בואו נניח ש-$latex u\in V\_{2}$, בלי הגבלת הכלליות; אז נגדיר $latex S=V\_{1}$.

כעת, מה הולך כאן? מצד אחד, הדרגה של כל צומת בתת-הגרף שמושרה על $latex S$ היא זוגית, מה שאומר בדיוק שלכל $latex v\in S$ יש מספר זוגי של שכנים ב-$latex S$; מצד שני, אם $latex v\notin S$ והוא מחובר ל-$latex u$, זה אומר שהוא מחובר למספר זוגי של צמתים שאינם ב-$latex S$ **כולל הצומת החדש** $latex u$. זה שאומר ש-$latex v$ מחובר למספר **אי זוגי** של צמתים שאינם ב-$latex S$ ואינם $latex u$. כעת מגיע טיעון המחץ: את $latex u$ חיברנו רק לצמתים שהיו מדרגה זוגית מלכתחילה, ולכן אם $latex v$ מחובר למספר אי זוגי של צמתים שאינם מ-$latex S$ ודרגתו לפני הוספת $latex u$ לגרף הייתה זוגית, הוא חייב להיות מחובר למספר אי זוגי של צמתים מ-$latex S$. אם לעומת זאת $latex v$ לא מחובר ל-$latex u$ זה אומר שדרגתו בגרף המקורי הייתה אי זוגית, וכעת הוא מחובר למספר זוגי של צמתים שאינם ב-$latex S$ ולכן גם כאן הוא חייב להיות מחובר למספר אי זוגי של צמתים מ-$latex S$. סוף המשחק.

טוב ויפה, אבל איך מוצאים פירוק ל-$latex V\_{1},V\_{2}$ שכזה? אם בגרף שלנו כל הצמתים מדרגה זוגית אז $latex V\_{1}=V,V\_{2}=\emptyset$ הוא פירוק טריוויאלי שכזה (ועל הדרך יש בגרף [מעגל אוילרי](http://www.gadial.net/?p=125)) אבל אפשר לצפות שבאופן כללי יהיה בגרף איזה צומת $latex v$ שהוא מדרגה לא זוגית. אם כן, הופס! נוציא את $latex v$ מהגרף.

למרבה הצער, זה לא מספיק. נצטרך לעשות התחכמות נוספת שחשיבותה תתברר בקרוב. בואו נסמן ב-$latex S$ את קבוצת השכנים של $latex v$ בגרף; לכל זוג צמתים $latex x,y\in S$, אם יש קשת בין $latex x,y$ נוריד אותה מהגרף, ואם אין קשת - נוסיף אותה לגרף.

אם כן, על ידי הוצאת $latex v$ קיבלנו גרף קטן יותר (עם פחות צמתים) ולכן אפשר לשלוף מהכיס את קסם [ההוכחה באינדוקציה](http://www.gadial.net/?p=897) ולטעון שבגרף הקטן יותר יש חלוקה לשתי קבוצות $latex W\_{1},W\_{2}$ כך שדרגת כל צומת בתת-הגרף שמושרה על ידי כל אחת מהקבוצות היא זוגית. מה שנרצה לעשות הוא להחזיר את $latex v$ לאחת מהקבוצות הללו, אבל לאיזו מהן? מכיוון ש-$latex S$ אי-זוגית, בהכרח $latex S\cap W\_{1}$ אי זוגית או $latex S\cap W\_{2}$ אי זוגית (אחרת היה אפשר לכתוב מספר אי זוגי כסכום שני מספרים זוגיים). בואו נניח ש-$latex S\cap W\_{1}$ זוגית - אני טוען שלהוסיף את $latex v$ לקבוצה הזו יסיים את העסק. כלומר, נגדיר $latex V\_{1}=W\_{1}\cup\left\{ v\right\} $ ו-$latex V\_{2}=W_{2}$. נותר רק להבין למה זה עובד.

ברור כי כל צמתי $latex V$ שלא היו שייכים ל-$latex S$ ואינם $latex v$ עדיין מקיימים את תכונת הזוגיות הנדרשת - מבחינתם לא שיניתי כלום. לעומת זאת, צמתי $latex S\cap W\_{1}$ חוו טראומה כפולה - גם חיברו להם את $latex v$ (ובכך שינו להם את הזוגיות) וגם הפכו את הקשתות בינם לבין עצמם. כל איבר של $latex S$ היה מחובר למספר אי זוגי של שכנים מתוך $latex S$ ב-$latex W\_{1}$, מה שאומר שמספר השכנים מתוך $latex S$ ב-$latex W_{1}$ שהוא **לא** היה מחובר אליהם היה בעל סימן הפוך, ולכן אחרי היפוך הקשתות הזוגיות משתנה ומבטלת את שינוי הזוגיות ש-$latex v$ גרם לו.

מבלבל? בהחלט. בואו נראה דוגמת צעצוע. נניח ש-$latex S\cap W\_{1}$ הייתה מגודל 6. נסתכל על צומת $latex x\in S\cap W\_{1}$ כלשהו. יש לו בדיוק 5 שכנים פוטנציאליים שגם הם ב-$latex S\cap W\_{1}$. נניח שכרגע יש לו קשת ל-2 מהם, זה אומר שאין קשת ל-3, ואחרי שנהפוך את זה (נמחק את הקשתות הקיימות וניצור את כל הקשתות שלא היו קודם) הזוגיות של הדרגה של $latex x$ תשתנה בשל כך (קודם היא הייתה זוגית, עכשיו היא כבר לא). אם לעומת זאת הייתה קשת מ-$latex x$ רק לצומת אחד אחר ב-$latex S\cap W\_{1}$ אחרי השינוי תהיה קשת ל-4: שוב שינוי בזוגיות. תוסיפו לכך את השינוי בזוגיות ש-$latex v$ גורם לו, וקיבלנו שגם ב-$latex V_{1}$ האיבר $latex x$ מחובר רק למספר זוגי של צמתים.

עכשיו כבר די ברור מה קורה ב-$latex S\cap W\_{2}$, אני מקווה. אנחנו לא מוסיפים את $latex v$ לשם כך שהוא לא גורם לשום שינוי. מצד שני, גם היפוך הקשתות לא יגרום לשום שינוי, כי לכל צומת $latex x\in S\cap W\_{2}$ יש מספר שכנים פוטנציאלי **זוגי** מתוך $latex S\cap W_{2}$. לכן: או שקודם $latex x$ היה מחובר למספר זוגי, ואחרי השינוי הוא עדיין יהיה מחובר למספר זוגי, או שקודם הוא היה מחובר למספר אי זוגי, ואחרי השינוי הוא עדיין יהיה מחובר למספר אי זוגי. סיימנו.

ההוכחה הזו עלולה להיראות מסורבלת ממבט ראשון אבל אני חושב שהיא אלגנטית למדי. יתרון חשוב שלה היא שזו הוכחה קונסטרוקטיבית - אפשר לחלץ ממנה אלגוריתם רקורסיבי שממש מוצא את הפתרון ורץ בזמן סביר. די בכך כדי לסגור את סיפור המשחק הזה, אבל אני רוצה להציג את נקודת המבט של האלגברה הלינארית על העניין - כפי שנראה, במובנים מסויימים היא חזקה וכללית יותר.

כבר הזכרתי ב[פוסט על כפל מטריצות](http://www.gadial.net/?p=1358) את הרעיון לפיו אפשר לייצג גרף באמצעות מטריצה, ובכך להכניס את האלגברה הלינארית לתורת הגרפים בדלת הקדמית. אם הגרף מכיל את הצמתים $latex \left\{ v\_{1},\dots,v\_{n}\right\} $ אז המטריצה, שאסמן $latex A$, תהיה מסדר $latex n\times n$, כך שהכניסה $latex A\_{ij}$ שווה 1 אם יש קשת בין $latex v\_{i}$ ו-$latex v\_{j}$ ו-0 אחרת. במקרה שלנו הגרף איננו מכוון כך ש-$latex A\_{ij}=A_{ji}$ - המטריצה **סימטרית**. מכיוון שהמטריצה מכילה רק 0 ו-1 ואין משמעות לערכים אחרים, הגיוני לחשוב עליה בתור מטריצה מעל השדה הפצפון $latex \mathbb{F}_{2}=\left\{ 0,1\right\} $ (אלגברה לינארית תמיד עושים מעל שדה, אחרת תוצאות בסיסיות - כמו זה שאפשר לדרג כל מטריצה - פשוט לא עובדות יותר).

כעת, מה המשמעות של כפל המטריצה $latex A$ בוקטור $latex x$ כלשהו מעל $latex \mathbb{F}\_{2}$? התוצאה תהיה וקטור $latex u$ כך ש-$latex y\_{i}=\sum\_{j=1}^{n}A\_{ij}x\_{j}$, כלומר $latex y\_{i}$ הוא מספר האינדקסים $latex j\in\left\{ 1,\dots,n\right\} $ כך שבו זמנית $latex A\_{ij}=1$ וגם $latex x\_{j}=1$. חשבו על $latex x\_{j}=1$ כאומר "בחרנו ללחוץ על $latex x\_{j}$ בפתרון שלנו", ואז $latex y\_{i}$ מתאר בדיוק מה יהיה המצב של הצומת $latex v\_{i}$ אחרי הלחיצות - אנחנו עוברים על כל צומת שמחובר ל-$latex v\_{i}$ בקשת ואם רואים שבחרנו ללחוץ עליו, אנחנו מוסיפים 1 ל-$latex y\_{i}$ ובסופו של דבר (בגלל שאנחנו מעל $latex \mathbb{Z}\_{2}$) נקבל ש-$latex y\_{i}$ מכיל את זוגיות מספר הלחיצות. שימו לב שבשביל שזה יעבוד אנחנו חייבים לקבוע ש-$latex A_{ii}=1$ לכל $latex i$, כי הרי לחיצה על צומת משנה גם את מצבו שלו (אפשר - וכדאי - לחשוב על כך כאילו יש קשת מהצומת לעצמו וחסל).

אם לסכם, מה שאנחנו רוצים לעשות הוא פשוט לפתור את המשוואה $latex Ax=\overline{1}$, כאשר $latex \overline{1}$ הוא הוקטור שכולו אחדות (ואם הלוח התחיל ממצב אחר שבו לא כל המשבצות כבויות, פשוט יש משוואה שונה שאפשר לנסות לפתור - אבל במקרה הזה לא מובטח שהיא תהיה פתירה בהכרח; נסו למצוא לוח לא פתיר!). הנה הצלחנו לתרגם עוד בעיה קומבינטורית לגמרי לבעיה בסיסית של אלגברה לינארית. האופן שבו פותרים את הבעיה ידוע - דירוג מטריצות, שניתן לביצוע באופן כללי ביעילות סבירה - ועיקר העניין כרגע הוא בהוכחה שתמיד קיים פתרון. ההוכחה עצמה היא עניין של שורה או שתיים שמבוססות על תוצאות סטנדרטיות באלגברה לינארית - אבל תוצאות שטרם הראיתי, וזו הזדמנות טובה לראות להן דוגמה קונקרטית לפני שמציגים את התורה הכללית.

בתור התחלה, שימו לב ש-$latex Ax$ הוא בעצם צירוף לינארי של עמודות $latex A$ שמקדמיו נקבעים לפי הכניסות של $latex x$. באופן דומה, $latex xA$ הוא צירוף לינארי של שורות $latex A$ (כרגיל, אני ממשיך במנהג הנלוז שלי לכתוב $latex x$ גם לוקטור שורה וגם לוקטור עמודה מתוך הנחה שתבינו מההקשר: $latex Ax$ הוא מכפלה של $latex A$ בוקטור עמודה, ואילו $latex xA$ הוא מכפלה של $latex A$ בוקטור שורה). במקרה שלנו $latex A$ סימטרית, ולכן אם משהו נמצא בתמונה של $latex A$ (כלומר, מתקבל על ידי כפל $latex Ax$) הוא נמצא במרחב שנפרש על ידי שורות $latex A$ ולהיפך. נשארנו עם להוכיח ש-$latex \overline{1}$ נמצא במרחב שנפרש על ידי שורות $latex A$. את המרחב הזה קל במיוחד להבין על ידי התבוננות בגרעין של $latex A$, $latex \ker A$ - כל הוקטורים $latex c$ שמקיימים $latex Ac=\overline{0}$.

שימו לב לכך שאם יש לנו $latex c\in\ker A$ אז מתקיים $latex \left(xA\right)c=x\left(Ac\right)=x\overline{0}=0$. במילים: אם ניקח וקטור כלשהו שנפרש על ידי שורות $latex A$ ונכפול אותו עם איבר של $latex \ker A$, נקבל 0. אם הרעיון של כפל שני וקטורים מבלבל אתכם, זכרו שהאחד הוא וקטור שורה והשני וקטור עמודה ואפשר לחשוב על הכפל כמכפלה של מטריצה $latex 1\times n$ במטריצה $latex n\times1$. אפשר גם לחשוב על זה כך: אם $latex x=\left(x\_{1},\dots,x\_{n}\right)$ ו-$latex y=\left(y\_{1},\dots,y\_{n}\right)$, אפשר להגדיר מכפלה שלהם על ידי $latex x\cdot y=\sum\_{i=1}^{n}x\_{i}y_{i}$. זה זהה לחלוטין למה שמתקבל מכפל המטריצות, אבל אנחנו כבר לא צריכים להטריד את עצמנו בעניינים כמו מי וקטור שורה ומי וקטור עמודה. המכפלה שהגדרתי כרגע נקראת **מכפלה סקלרית** של וקטורים, ועוד נפגוש בה בהמשך הפוסטים על אלגברה לינארית.

אם $latex x\cdot y=0$ אומרים ש-$latex x,y$ **אורתוגונליים** (מאונכים), מסיבות גאומטריות שיובהרו בפעם אחרת. לעת עתה, מה שראינו הוא שכל איבר במרחב השורות של $latex A$ אורתוגונלי לכל איבר בגרעין של $latex A$. אני רוצה לטעון שגם ההפך הוא נכון - אם $latex x$ אורתוגונלי לכל איבר בגרעין של $latex A$, אז $latex x$ נמצא במרחב השורות של $latex A$.

לב הענין הוא בטענה הבאה: אם $latex V$ הוא מרחב וקטורי **כלשהו**, ואם $latex W$ הוא תת מרחב **כלשהו**, ואם $latex W^{\perp}=\left\{ x|\forall y\in W:xy=0\right\} $ הוא אוסף כל האיברים ב-$latex V$ שאורתוגונליים לכל איברי $latex W$, אז $latex \dim V=\dim W+\dim W^{\perp}$. לא אוכיח כרגע את התכונה הזו אבל אני מקווה שאסגור את החשבון באחד מהפוסטים העתידיים. כדי להבין איך הטענה הזו עוזרת לנו, זכרו שמתקיים $latex \dim V=\dim\ker A+\dim\mbox{Im}A$ - זו תכונה חשובה של טרנספורמציות לינאריות ש[כבר הוכחתי](http://www.gadial.net/?p=1389) בעבר. אם $latex W=\ker A$ אז חיבור שני השוויונות מראה לנו שמימד מרחב השורות של $latex A$ הוא כמימד $latex W^{\perp}$ ומכיוון שידוע לנו שמרחב השורות מוכל ב-$latex W^{\perp}$ עולה שהם שווים, מה שמסיים את הוכחת הטענה שאם וקטור אורתוגנלי לכל הגרעין אז הוא במרחב השורות.

כל שנותר לעשות הוא להוכיח שהוקטור $latex \overline{1}$ אורתוגונלי לכל איבר בגרעין של $latex A$. לצורך כך אנחנו שולפים מהשרוול את התעלול האחרון שלנו, שעובד רק מעל $latex \mathbb{F}_{2}$. ניקח וקטור כלשהו $latex v$. מהו $latex vAv$? אם נחשב לפי ההגדרה הישירה, נקבל ש-

$latex vAv=v\cdot\left(\sum\_{i=1}^{n}A\_{1i}v\_{i},\dots,\sum\_{i=1}^{n}A\_{ni}v\_{i}\right)=\sum\_{j=1}^{n}v\_{j}\left(\sum\_{i=1}^{n}A\_{ji}v\_{i}\right)=\sum\_{i,j=1}^{n}A\_{ji}v\_{i}v_{j}$

בהערת אגב אציין שהרעיון הזה, של לכפול מטריצה מימין ומשמאל בוקטור כדי לקבל סקלר, הוא מה שעומד בלב המושג של **תבניות בילינאריות** שאני מקווה להגיע אליהן בהמשך. מה שקורה כרגע הוא מקרה פרטי שבו העסק פשוט הרבה יותר בגלל שאנחנו מעל $latex \mathbb{F}\_{2}$ ובגלל ש-$latex A$ סימטרית. שימו לב שבגלל הסימטריה הזו, $latex A\_{ji}=A\_{ij}$ ואם $latex i\ne j$ אז בסכום מופיעים גם $latex A\_{ji}v\_{j}v\_{i}$ וגם $latex A\_{ij}v\_{i}v\_{j}$ והסכום של שניהם הוא פשוט $latex 2A\_{ij}v\_{j}v\_{i}=0$ - אפס, כי אנחנו ב-$latex \mathbb{F}\_{2}$. לכן מכל הסכום נותר לנו רק $latex \sum\_{i=1}^{n}A\_{ii}v\_{i}^{2}$. בגלל שאנחנו מעל $latex \mathbb{F}\_{2}$, אז $latex v\_{i}^{2}=v\_{i}$ (כי $latex v\_{i}\in\left\{ 0,1\right\} $), ולכן קיבלנו שנותר לנו רק $latex \sum\_{i=1}^{n}A\_{ii}v_{i}$ - וזו, במילים אחרות, המכפלה הסקלרית של האלכסון של $latex A$ עם הוקטור $latex v$.

כעת, אם $latex v$ בגרעין של $latex A$, אז $latex Av=0$ ולכן בוודאי $latex vAv=0$, ולכן האלכסון של $latex A$ אכן אורתוגונלי לגרעין של $latex A$ וההוכחה נסתיימה. אולי היא נראית קצת מסורבלת ומוזרה כעת, אבל למי שבקיא במושגים היא לא דורשת יותר משורה-שתיים.

אם כן, איזו הוכחה מבין השתיים שהצגתי עדיפה? התשובה פשוטה - אף אחת מהן. ריבוי הוכחות עם אופי שונה הוא דבר נפלא במתמטיקה, וממש לא צריך להשוות.